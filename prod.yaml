# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

url: 'https://ci.ursalabs.org/'
webui_port: 8010

secrets:
  enabled: true

hooks:
  github:
    enabled: true
    debug: false

changes:
  pb:
    enabled: true
    port: 9041

auth:
  enabled: true
  roles:
    admin:
      orgs:
        - 'ursa-labs'
      users:
        - 'xhochy'
        - 'kou'

ursabot:
  reporters:
    github_status:
      enabled: true

arrow:
  reporters:
    github_status:
      enabled: true
      tokens:
        - '%(secret:kszucs/github_status_token)s'
        - '%(secret:pitrou/github_status_token)s'
    github_comment:
      enabled: true
      tokens:
        - '%(secret:ursabot/github_token)s'
    zulip_status:
      enabled: true
      organization: 'ursalabs'
      bot: 'ursabot-bot@ursalabs.zulipchat.com'
      stream: 'ursabot'
      apikey: '%(secret:ursabot/zulip_api_key)s'

workers:
  - name: 'dgx1-1'
    arch: 'amd64'
    docker:
      host: 'tcp://ursa-dgx1:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '0-3,20-23'

  - name: 'dgx1-2'
    arch: 'amd64'
    docker:
      host: 'tcp://ursa-dgx1:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '4-7,24-27'

  - name: 'dgx1-3'
    arch: 'amd64'
    docker:
      host: 'tcp://ursa-dgx1:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '8-11,28-31'

  - name: 'dgx1-4'
    arch: 'amd64'
    docker:
      host: 'tcp://ursa-dgx1:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '12-15,32-35'

  - name: 'dgx1-5'
    arch: 'amd64'
    docker:
      host: 'tcp://ursa-dgx1:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '16-19,36-39'

  - name: 'dgx2-1'
    arch: 'amd64'
    tags:
      - cuda
    docker:
      host: 'tcp://ursa-dgx2:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '0-3,20-23'

  - name: 'dgx2-2'
    arch: 'amd64'
    tags:
      - cuda
    docker:
      host: 'tcp://ursa-dgx2:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '4-7,24-27'

  - name: 'dgx2-3'
    arch: 'amd64'
    tags:
      - cuda
    docker:
      host: 'tcp://ursa-dgx2:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '8-11,28-31'

  - name: 'dgx2-4'
    arch: 'amd64'
    tags:
      - cuda
    docker:
      host: 'tcp://ursa-dgx2:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '12-15,32-35'

  - name: 'dgx2-5'
    arch: 'amd64'
    tags:
      - cuda
    docker:
      host: 'tcp://ursa-dgx2:2375'
      hostconfig:
        network_mode: 'host'
        cpuset_cpus: '16-19,36-39'

  - name: 'jetson1'
    arch: 'arm64v8'
    tags:
      - cuda
    max_builds: 1
    docker:
      host: 'tcp://ursa-jetson1:2375'
      hostconfig:
        network_mode: 'host'
